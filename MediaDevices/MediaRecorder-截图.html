<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <div>
      <button id="btnRecord">录制</button>
    </div>

    <script>
      document
        .getElementById("btnRecord")
        .addEventListener("click", startRecording);

      async function startRecording() {
        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: true,
        });
        const mediaRecorder = new MediaRecorder(stream);
        const videoChunks = [];

        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            videoChunks.push(event.data);
          }
        };

        mediaRecorder.onstop = () => {
          const videoBlob = new Blob(videoChunks, { type: "video/webm" });
          const videoUrl = URL.createObjectURL(videoBlob);

          // 创建一个 <video> 元素来播放录制的视频
          const videoElement = document.createElement("video");
          videoElement.src = videoUrl;
          videoElement.controls = true;
          document.body.appendChild(videoElement);

          // 添加按钮以允许用户从视频中截取图片
          const captureButton = document.createElement("button");
          captureButton.innerText = "Capture Frame";
          captureButton.onclick = () => {
            const canvas = document.createElement("canvas");
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            canvas.getContext("2d").drawImage(videoElement, 0, 0);
            const link = document.createElement("a");
            link.download = "screenshot.png";
            link.href = canvas.toDataURL();
            link.click();
          };
          document.body.appendChild(captureButton);
        };

        mediaRecorder.start();

        // 提供停止录制的方式
        setTimeout(() => {
          mediaRecorder.stop();
        }, 1000); // 录制10秒后自动停止
      }
    </script>
  </body>
</html>
